# Line Companion Normalized Outputs

This directory contains the normalized Line Companion text and related processing artifacts.

## Files

### Core Outputs

- **`normalized.txt`** - The main normalized Line Companion text
  - Source: `s3-data/Line Companion_djvu.txt` (OCR text)
  - Normalization applied:
    - Line endings normalized (CRLF → LF)
    - OCR fixes applied (configurable dictionary)
    - Excessive blank lines collapsed (3+ → 1)
    - Mid-sentence newlines joined intelligently
  - Size: ~1.5MB, ~13,400 lines

- **`normalized.index.json`** - Metadata and sample offsets for LLM-assisted review
  - Contains: total_lines, total_characters, source info
  - Includes 20 sample line offsets for quick navigation

- **`OCR_ISSUES.md`** - Log of detected OCR errors
  - Lists lines >1500 characters (potential OCR errors)
  - Empty if no issues detected

### Chunked Outputs (Optional)

When `CHUNK_NORMALIZED=1` environment variable is set, the script generates:

- **`normalized-part01.txt`** through **`normalized-partNN.txt`**
  - 500 lines per chunk
  - Useful for interactive review or processing in smaller batches
  - Generated on-demand only

## Generation

These files are generated by:
```bash
python3 lore-research/scripts/01-normalize-line-companion.py
```

To generate with chunks:
```bash
CHUNK_NORMALIZED=1 python3 lore-research/scripts/01-normalize-line-companion.py
```

## Source Priority

The normalization script follows this source priority order:
1. `normalized.txt` (if already exists - idempotent)
2. `s3-data/Line Companion_djvu.txt` (preferred OCR source)
3. `s3-data/Line Companion.epub`
4. `s3-data/Line Companion_djvu.xml`
5. `s3-data/Line Companion_scandata.xml`
6. `s3-data/Line Companion_abbyy.gz`

## Next Steps

After normalization, the text flows through:
1. **Stage 2**: Gate splitting (`02-split-gates.py`)
2. **Stage 3**: Line splitting (`03-split-lines-per-gate.py`)
3. **Stage 4**: Quote extraction (`04-extract-quotes.py`)

See `lore-research/scripts/README.md` for the complete pipeline.
