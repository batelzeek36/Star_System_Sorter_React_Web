# BodyGraph API Key (DO NOT use VITE_ prefix - this is server-side only)
# Get your API key from: https://bodygraphchart.com/api
BODYGRAPH_API_KEY=7aa0cf1a-5a70-4a1f-b9bd-bbf5877079f2

# OpenAI API Key for narrative generation (optional)
# Get your API key from: https://platform.openai.com/api-keys
# If not provided, will use fallback template narratives
OPENAI_API_KEY=your_openai_api_key_here

# Server port (optional, defaults to 3000)
PORT=3000

# ============================================================================
# Redis Cache Configuration
# ============================================================================

# Redis connection URL
# Format: redis://[username:password@]host:port[/database]
# For TLS: rediss://[username:password@]host:port[/database]
# Examples:
#   - Local: redis://localhost:6379
#   - Upstash: rediss://default:password@region.upstash.io:6379
#   - Redis Cloud: rediss://default:password@redis-12345.cloud.redislabs.com:12345
REDIS_URL=redis://localhost:6379

# Cache key prefix for multi-tenant isolation
# Used to namespace all cache keys (e.g., "narr:v1:...")
# Default: narr
CACHE_PREFIX=narr

# ============================================================================
# Cache TTL and Staleness Configuration
# ============================================================================

# Number of days before cached content is considered stale
# Stale content is served immediately while refreshing in background (SWR)
# Default: 7 days
STALE_DAYS=7

# Number of days before cached content expires completely
# After TTL, content is removed from cache
# Default: 30 days
TTL_DAYS=30

# ============================================================================
# Cache Value Size Limits
# ============================================================================

# Maximum size of cached values in bytes (before compression)
# Values exceeding this limit will be rejected
# Default: 131072 (128 KB)
CACHE_MAX_VALUE_BYTES=131072

# Threshold for automatic gzip compression in bytes
# Values larger than this will be compressed automatically
# Default: 65536 (64 KB)
CACHE_COMPRESS_THRESHOLD=65536

# ============================================================================
# Redis Eviction Policy
# ============================================================================

# Redis eviction policy when memory limit is reached
# Recommended: allkeys-lru (evict any key using LRU)
# Alternative: volatile-ttl (evict keys with TTL set, oldest first)
# Options: noeviction, allkeys-lru, allkeys-lfu, allkeys-random,
#          volatile-lru, volatile-lfu, volatile-random, volatile-ttl
# Default: allkeys-lru
CACHE_EVICTION_POLICY=allkeys-lru

# ============================================================================
# Feature Flags (Gradual Rollout)
# ============================================================================

# Enable Redis caching (set to 'true' to activate)
# Default: false
ENABLE_REDIS_CACHE=false

# Enable Stale-While-Revalidate strategy
# Serves stale content immediately while refreshing in background
# Default: false
ENABLE_SWR=false

# Enable stampede protection (distributed locking)
# Prevents multiple concurrent requests from generating same narrative
# Default: false
ENABLE_STAMPEDE_PROTECTION=false

# Enable negative caching (cache validation errors)
# Caches known-invalid profiles for 15 minutes
# Default: false
ENABLE_NEGATIVE_CACHE=false

# ============================================================================
# Engine Versioning
# ============================================================================

# Engine version for cache key generation
# Bump this to invalidate all cached narratives
# Format: narrative@major.minor.patch
# Default: narrative@1.0.0
ENGINE_VERSION=narrative@1.0.0

# Prompt hash for cache key generation
# Change this when narrative prompt changes to invalidate cache
# Use lowercase hex string (10 characters recommended)
# Default: default
PROMPT_HASH=default
